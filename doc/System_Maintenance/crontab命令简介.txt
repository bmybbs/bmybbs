发信人: macintosh (苹果～小ｍ|信任), 信区: Program_Team
标  题: crontab命令简介
发信站: 兵马俑BBS (Fri Nov 18 17:09:18 2005), 本站(202.117.1.8)

crontab命令

　　crontab命令用于安装、删除或者列出用于驱动cron后台进程的表格。也就是说，用户
把需要执行的命令序列放到crontab文件中以获得执行。每个用户都可以有自己的crontab文
件。下面就来看看如何创建一个crontab文件。

　　在/var/spool/cron下的crontab文件不可以直接创建或者直接修改。crontab文件是通
过crontab命令得到的。现在假设有个用户名为foxy，需要创建自己的一个crontab文件。首
先可以使用任何文本编辑器建立一个新文件，然后向其中写入需要运行的命令和要定期执行
的时间。

　　然后存盘退出。假设该文件为/tmp/test.cron。再后就是使用crontab命令来安装这个
文件，使之成为该用户的crontab文件。键入：

　　crontab test.cron

　　这样一个crontab 文件就建立好了。可以转到/var/spool/cron目录下面查看，发现多
了一个foxy文件。这个文件就是所需的crontab 文件。用more命令查看该文件的内容可以发
现文件头有三行信息：

　　#DO NOT EDIT THIS FILE -edit the master and reinstall.

　　#（test.cron installed on Mon Feb 22 14:20:20 1999）

　　#（cron version --$Id: crontab命令简介.txt,v 1.1 2006/06/18 03:35:41 interma Exp $）

　　大概意思是：

　　#切勿编辑此文件――如果需要改变请编辑源文件然后重新安装。

　　#test.cron文件安装时间：14:20:20 02/22/1999

　　如果需要改变其中的命令内容时，还是需要重新编辑原来的文件，然后再使用crontab
命令安装。

　　可以使用crontab命令的用户是有限制的。如果/etc/cron.allow文件存在，那么只有其
中列出的用户才能使用该命令；如果该文件不存在但cron.deny文件存在，那么只有未列在
该文件中的用户才能使用crontab命令；如果两个文件都不存在，那就取决于一些参数的设
置，可能是只允许
超级用户使用该命令，也可能是所有用户都可以使用该命令。

　　crontab命令的语法格式如下：

　　crontab [-u user] file

　　crontab [-u user]{-l|-r|-e}

　　第一种格式用于安装一个新的crontab 文件，安装 淳褪file所指的文件，如果使用“
-”符号作为文件名，那就意味着使用标准输入作为安装来源。

　　-u 如果使用该选项，也就省Ｋ以如果是使用了su命令，最好使用-u选项来指定究竟是
哪个用户的crontab文件。

　　-l 在标准输出上显示当前的crontab。

　　-r 删除当前的crontab文件。

　　-e 使用VISUAL或者EDITOR环境变量所指的编辑器编辑当前的crontab文件。当结束编辑
离开时，编辑后的文件将自动安装。

　　[例7]

　　# crontab -l #列出用户目前的crontab。

　　10 6 * * * date

　　0 */2 * * * date

　　0 23-7/2，8 * * * date

　　#

　　在crontab文件中如何输入需要执行的命令和时间。该文件中每行都包括六个域，其中
前五个域是指定命令被执行的时间，最后一个域是要被执行的命令。每个域之间使用空格或
者制表符分隔。格式如下：

　　minute hour day-of-month month-of-year day-of-week commands

　　第一项是分钟，第二项是小时，第三项是一个月的第几天，第四项是一年的第几个月，
第五项是一周的星期几，第六项是要执行的命令。这些项都不能为空，必须填入。如果用户
不需要指定其中的几项，那么可以使用*代替。因为*是统配符，可以代替任何字符，所以就
可以认为是任何
时间，也就是该项被忽略了。在表4-1中给出了每项的合法范围。

　表4-1　指定时间的合法范围

　　时间
　　合法值

　 minute
　　00-59

　　hour
　　00-23，其中00点就是晚上12点

　　day-of-month
　　01-31

　　month-of-year
　　01-12

　　day-of-week
　　0-6，其中周日是0


　　这样用户就可以往crontab
文件中写入无限多的行以完成无限多的命令。命令域中可以写入所有可以在命令行写入的命
令和符号，其他所有时间域都支持列举，也就是域中可以写入很多的时间值，只要满足这些
时间值中的任何一个都执行命令，每两个时间值中间使用逗号分隔。

　除了数字还有几个个特殊的符号就是"*"、"/"和"-"、","，*代表所有的取值范围内的数
字，"/"代表每的意思,"*/5"表示每5个单位，"-"代表从某个数字到某个数字,","分开几个
离散的数字。几个例子：

每天早上6点

0 6 * * * echo "Good morning." >> /tmp/test.txt //注意单纯echo，从屏幕上看不到任
何输出，因为cron把任何输出都email到root的信箱了。

每两个小时

0 */2 * * * echo "Have a break now." >> /tmp/test.txt

晚上11点到早上8点之间每两个小时，早上八点

0 23-7/2，8 * * * echo "Have a good dream：）" >> /tmp/test.txt

每个月的4号和每个礼拜的礼拜一到礼拜三的早上11点

0 11 4 * 1-3 command line

1月1日早上4点

0 4 1 1 * command line


SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root //如果出现错误，或者有数据输出，数据作为邮件发给这个帐号
HOME=/ //使用者运行的路径,这里是根目录
# run-parts
01 * * * * root run-parts /etc/cron.hourly //每小时执行/etc/cron.hourly内的脚本
02 4 * * * root run-parts /etc/cron.daily //每天执行/etc/cron.daily内的脚本
22 4 * * 0 root run-parts /etc/cron.weekly //每星期执行/etc/cron.weekly内的脚本
42 4 1 * * root run-parts /etc/cron.monthly //每月去执行/etc/cron.monthly内的脚
本



大家注意"run-parts"这个参数了，如果去掉这个参数的话，后面就可以写要运行的某个脚
本名，而不是文件夹名了。 　

[例8]

　　5，15，25，35，45，55 16，17，18 * * * command

　　这就是表示任意天任意月，其实就是每天的下午4点、5点、6点的5 min、15 min、25
min、35 min、45 min、55 min时执行命令。

　　[例9] 在每周一，三，五的下午3：00系统进入维护状态，重新启动系统。那么在
crontab 文件中就应该写入如下字段：

　　00 15 * * 1，3，5 shutdown -r +5

　　然后将该文件存盘为foxy.cron，再键入crontab foxy.cron安装该文件。

　　[例10] 每小时的10分，40分执行用户目录下的innd/bbslin这个指令：

　　10，40 * * * * innd/bbslink

　　[例11] 每小时的1分执行用户目录下的bin/account这个指令：

　　1 * * * * bin/account

　　[例12] 每天早晨三点二十分执行用户目录下如下所示的两个指令（每个指令以;分隔）
：

　　20 3 * * * （/bin/rm -f expire.ls logins.bad;bin/expire$#@62;expire.1st）

　　[例13] 每年的一月和四月，4号到9号的3点12分和3点55分执行/bin/rm -f
expire.1st这个指令，并把结果添加在mm.txt这个文件之后（mm.txt文件位于用户自己的目
录位置）。

　　12,55 3 4-9 1,4 * /bin/rm -f expire.1st$#@62;$#@62;mm.txt

　　[例14] 我们来看一个超级用户的crontab文件：

　　#Run the ‘atrun’ program every minutes

　　#This runs anything that’s due to run from ‘at’.See man ‘at’ or ‘
atrun’.

　　0,5,10,15,20,25,30,35,40,45,50,55 * * * * /usr/lib/atrun

　　40 7 * * * updatedb

　　8,10,22,30,39,46,54,58 * * * * /bin/sync

　　进程的挂起及恢复命令bg、fg

　　作业控制允许将进程挂起并可以在需要时恢复进程的运行，被挂起的作业恢复后将从中
止处开始继续运行。只要在键盘上按〈ctrl+z$#@62;，即可挂起当前的前台作业。

　　[例15]

　　$ cat text.file

　　〈ctrl+z$#@62;

　　[1] + stopped cat text.file

　　$ jobs

　　[1]+ stopped cat text.file

　　在键盘上按〈ctrl+z$#@62;后，将挂起当前执行的命令cat。使用jobs命令可以显示
shell的作业清单，包括具体的作业、作业号以及作业当前所处的状态。

　　恢复进程执行时，有两种选择：用fg命令将挂起的作业放回到前台执行；用bg命令将挂
起的作业放到后台执行。

--
　　[例16] 用户正在使用Emacs，突然需要查看系统进程情况。就首先使用〈
Ctrl+z$#@62;组合键将Emacs进程挂起，然后使用bg命令将其在后台启动，这样就得到了前
台的操作控制权，接着键入“ps
？x”查看进程情况。查看完毕后，使用fg命令将Emacs带回前台运行即可。其命令格式为：

　　〈Ctrl+z$#@62;

　　$ bg emacs

　　$ ps ？x

　　$ fg emacs

　　默认情况下，fg和bg命令对最近停止的作业进行操作。如果希望恢复其他作业的运行，
可以在命令中指定要恢复作业的作业号来恢复该作业。例如：

　　$ fg 1

　　cat text.file
，也就是执行该crontab 命令的用户的crontab 文件将被修改。但是请注意，如果使用了
su命令再使用crontab 命令很可能就会出现混乱的情况-- ※ 来源:．兵马俑BBS                                                  
202.117.1.8．[FROM: 202.200.239.156]                                                                                    
※ 修改:．macintosh 于 Nov 18 17:13:55 修改本文．[FROM: 202.200.239.156]                                                
※ 修改:．macintosh 于 Nov 18 17:14:32 修改本文．[FROM: 202.200.239.156]                                                
